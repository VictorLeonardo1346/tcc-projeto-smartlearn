<!-- templates/aluno_resultado.html -->
<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <title>Resultado do Questionário</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      /* === Estilo SmartLearn === */
      body {
        font-family: "Segoe UI", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #980909; /* fundo vermelho escuro */
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      /* Painel central */
      .card {
        background-color: #d9d9d9; /* cinza claro */
        width: 85%;
        max-width: 700px;
        padding: 40px 50px;
        border-radius: 12px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        text-align: center;
      }

      h1 {
        margin-top: 0;
        color: #000;
        font-size: 28px;
        margin-bottom: 30px;
      }

      p {
        color: #222;
        font-size: 16px;
        margin-bottom: 25px;
      }

      /* Métricas */
      .metrics {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 20px;
      }

      .metric {
        flex: 1 1 150px;
        background: #f3f3f3;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }

      .big {
        font-size: 28px;
        font-weight: 700;
        color: #000;
      }

      .small {
        color: #444;
        font-size: 13px;
      }

      /* Botões */
      .btn {
        display: inline-block;
        margin-top: 30px;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 8px;
        text-decoration: none;
        transition: all 0.2s ease-in-out;
        color: #fff;
      }

      .btn:hover {
        transform: scale(1.05);
      }

      .btn-voltar {
        background-color: #007acc;
      }

      .btn-voltar:hover {
        background-color: #005f99;
      }

      .btn-ranking {
        background-color: #008000;
        margin-left: 10px;
      }

      .btn-ranking:hover {
        background-color: #006400;
      }
    </style>
  </head>

  <body>
    <div class="card">
      <h1>Resultado do Questionário</h1>
      <p id="intro">Carregando resultados...</p>

      <div class="metrics" id="metrics" style="display: none">
        <div class="metric">
          <div class="big" id="score">0</div>
          <div class="small">Pontuação</div>
        </div>
        <div class="metric">
          <div class="big" id="acertos">0</div>
          <div class="small">Acertos</div>
        </div>
        <div class="metric">
          <div class="big" id="erros">0</div>
          <div class="small">Erros</div>
        </div>
        <div class="metric">
          <div class="big" id="taxa">0%</div>
          <div class="small">Taxa de acertos</div>
        </div>
      </div>

      <div>
        <a id="voltar" class="btn btn-voltar" href="/aluno"
          >Voltar para atividades</a
        >
        <a id="verRanking" class="btn btn-ranking" href="#"
          >Ver ranking (desta atividade)</a
        >
      </div>
    </div>

    <script>
      // pega parâmetros da query string
      const params = new URLSearchParams(window.location.search);
      const score = params.get("score") ?? params.get("pontuacao") ?? "0";
      const acertos = params.get("acertos") ?? "0";
      const erros = params.get("erros") ?? "0";
      const total = params.get("total") ?? "0";
      const user_name = params.get("user_name") ?? "Você"; // pega nome do aluno
      const taxa =
        params.get("taxa") ??
        (total == 0 ? "0" : ((acertos / total) * 100).toFixed(2));

      document.getElementById("metrics").style.display = "flex";
      document.getElementById("score").textContent = score;
      document.getElementById("acertos").textContent = acertos + " / " + total;
      document.getElementById("erros").textContent = erros;
      document.getElementById("taxa").textContent = taxa + "%";
      document.getElementById(
        "intro"
      ).textContent = `Você finalizou a atividade (Questionário ID: ${
        params.get("qid") || "?"
      }).`;

      // Configura o link do botão "Ver ranking (desta atividade)"
      const qid = params.get("qid");
      if (qid) {
        document.getElementById(
          "verRanking"
        ).href = `/aluno/ranking?qid=${qid}&user_name=${encodeURIComponent(
          user_name
        )}&score=${score}`;
      } else {
        document.getElementById("verRanking").style.display = "none";
      }
    </script>
  </body>
</html>
